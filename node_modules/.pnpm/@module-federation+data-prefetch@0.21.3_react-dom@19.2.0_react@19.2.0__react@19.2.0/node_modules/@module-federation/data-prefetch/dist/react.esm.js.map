{"version":3,"file":"react.esm.js","sources":["../src/react/utils.ts","../src/react/hooks.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nexport const useFirstMounted = () => {\n    const ref = useRef(true);\n    useEffect(() => {\n        ref.current = false;\n    }, []);\n    return ref.current;\n};\n","import { useEffect, useState } from 'react';\nimport logger from '../logger';\nimport { MFDataPrefetch } from '../prefetch';\nimport { prefetch } from '../universal';\nimport { getScope } from '../common/runtime-utils';\nimport { useFirstMounted } from './utils';\nexport const usePrefetch = (options) => {\n    const isFirstMounted = useFirstMounted();\n    if (isFirstMounted) {\n        const startTiming = performance.now();\n        logger.info(`2. Start Get Prefetch Data: ${options.id} - ${options.functionId || 'default'} - ${startTiming}`);\n    }\n    const { id, functionId, deferId } = options;\n    const prefetchInfo = {\n        id,\n        functionId,\n    };\n    const mfScope = getScope();\n    let state;\n    const prefetchResult = prefetch(options);\n    if (deferId) {\n        if (prefetchResult instanceof Promise) {\n            state = prefetchResult.then((deferredData) => deferredData.data[deferId]);\n        }\n        else {\n            state = prefetchResult.data[deferId];\n        }\n    }\n    else {\n        state = prefetchResult;\n    }\n    const [prefetchState, setPrefetchState] = useState(state);\n    const prefetchInstance = MFDataPrefetch.getInstance(mfScope);\n    useEffect(() => {\n        const useEffectTiming = performance.now();\n        logger.info(`3. Start Execute UseEffect: ${options.id} - ${options.functionId || 'default'} - ${useEffectTiming}`);\n        return () => {\n            prefetchInstance === null || prefetchInstance === void 0 ? void 0 : prefetchInstance.markOutdate(prefetchInfo, true);\n        };\n    }, []);\n    const refreshExecutor = (refetchParams) => {\n        const refetchOptions = Object.assign({}, options);\n        if (refetchParams) {\n            refetchOptions.refetchParams = refetchParams;\n        }\n        prefetchInstance === null || prefetchInstance === void 0 ? void 0 : prefetchInstance.markOutdate(prefetchInfo, true);\n        const newVal = prefetch(refetchOptions);\n        let newState;\n        if (deferId) {\n            if (newVal instanceof Promise) {\n                newState = newVal.then((deferredData) => deferredData.data[deferId]);\n            }\n            else {\n                newState = newVal.data[deferId];\n            }\n        }\n        else {\n            newState = newVal;\n        }\n        setPrefetchState(newState);\n    };\n    return [prefetchState, refreshExecutor];\n};\n"],"names":[],"mappings":"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"}